biigle.$viewModel("maia-job-form",function(e){new Vue({el:e,data:{showAdvanced:!1},methods:{toggle:function(){this.showAdvanced=!this.showAdvanced}}})}),biigle.$viewModel("maia-show-container",function(e){var i=biigle.$require("maia.job"),n=biigle.$require("maia.states"),t=biigle.$require("maia.api.maiaJob"),a=biigle.$require("maia.api.maiaAnnotation"),o=biigle.$require("messages.store");new Vue({el:e,mixins:[biigle.$require("core.mixins.loader")],components:{sidebar:biigle.$require("annotations.components.sidebar"),sidebarTab:biigle.$require("core.components.sidebarTab"),selectTpTab:biigle.$require("maia.components.selectTpTab"),tpImageGrid:biigle.$require("maia.components.tpImageGrid"),refineTpTab:biigle.$require("maia.components.refineTpTab")},data:{visitedSelectTpTab:!1,visitedRefineTpTab:!1,visitedReviewAcTab:!1,openTab:"info",trainingProposals:[],selectTpOffset:0,lastSelectedTp:null},computed:{infoTabOpen:function(){return"info"===this.openTab},selectTpTabOpen:function(){return"select-training-proposals"===this.openTab},refineTpTabOpen:function(){return"refine-training-proposals"===this.openTab},reviewAcTabOpen:function(){return"review-annotation-candidates"===this.openTab},visitedSelectOrRefineTpTab:function(){return this.visitedSelectTpTab||this.visitedRefineTpTab},hasNoTrainingProposals:function(){return 0===this.trainingProposals.length},isInTrainingProposalState:function(){return i.state_id===n["training-proposals"]}},methods:{handleSidebarToggle:function(){this.$nextTick(function(){this.$refs.imageGrid.$emit("resize")})},handleTabOpened:function(e){this.openTab=e},setTrainingProposals:function(e){this.trainingProposals=e.body},fetchTrainingProposals:function(){this.startLoading(),t.getTrainingProposals({id:i.id}).then(this.setTrainingProposals).catch(o.handleErrorResponse).finally(this.finishLoading)},openRefineTpTab:function(){this.openTab="refine-training-proposals"},handleSelectedTrainingProposal:function(e,i){e.selected?(e.selected=!1,a.update({id:e.id},{selected:!1}).catch(function(i){o.handleErrorResponse(i),e.selected=!0})):i.shiftKey&&this.lastSelectedTp?this.selectAllTpBetween(e,this.lastSelectedTp):(this.lastSelectedTp=e,this.storeSelectTrainingProposal(e))},updateSelectTpOffset:function(e){this.selectTpOffset=e},selectAllTpBetween:function(e,i){var n=this.trainingProposals.indexOf(e),t=this.trainingProposals.indexOf(i);if(t<n){var a=t;t=n,n=a}for(var o=n+1;o<=t;o++)this.storeSelectTrainingProposal(this.trainingProposals[o])},storeSelectTrainingProposal:function(e){e.selected=!0,a.update({id:e.id},{selected:!0}).catch(function(i){o.handleErrorResponse(i),e.selected=!1})},startInstanceSegmentation:function(){console.log("start instance segmentation")}},watch:{selectTpTabOpen:function(){this.visitedSelectTpTab=!0},refineTpTabOpen:function(){this.visitedRefineTpTab=!0},reviewAcTabOpen:function(){this.visitedReviewAcTab=!0},visitedSelectOrRefineTpTab:function(){this.fetchTrainingProposals()}}})}),biigle.$declare("maia.api.maiaAnnotation",Vue.resource("api/v1/maia-annotations{/id}",{},{getFile:{method:"GET",url:"api/v1/maia-annotations{/id}/file"}})),biigle.$declare("maia.api.maiaJob",Vue.resource("api/v1/maia-jobs{/id}",{},{save:{method:"POST",url:"api/v1/volumes{/id}/maia-jobs"},getTrainingProposals:{method:"GET",url:"api/v1/maia-jobs{/id}/training-proposals"}})),biigle.$component("maia.components.refineTpTab",{props:{},data:function(){return{}},computed:{},methods:{proceed:function(){this.$emit("proceed")}},created:function(){}}),biigle.$component("maia.components.selectTpTab",{props:{trainingProposals:{type:Array,required:!0}},data:function(){return{}},computed:{selectedTp:function(){return this.trainingProposals.filter(function(e){return e.selected})},selectedTpCount:function(){return this.selectedTp.length},tpCount:function(){return this.trainingProposals.length}},methods:{proceed:function(){this.$emit("proceed")}},created:function(){}}),biigle.$component("maia.components.tpImageGrid",{mixins:[biigle.$require("volumes.components.imageGrid")],components:{imageGridImage:biigle.$require("maia.components.tpImageGridImage")}}),biigle.$component("maia.components.tpImageGridImage",{mixins:[biigle.$require("volumes.components.imageGridImage")],template:'<figure class="image-grid__image" :class="classObject" :title="title"><div v-if="showIcon" class="image-icon"><i class="fas fa-3x" :class="iconClass"></i></div><img @click="toggleSelect" :src="url || emptyUrl"><div v-if="showAnnotationLink" class="image-buttons"><a :href="showAnnotationLink" target="_blank" class="image-button" title="Show the annotation in the annotation tool"><span class="fa fa-external-link-square-alt" aria-hidden="true"></span></a></div></figure>',computed:{showAnnotationLink:function(){return!1},selected:function(){return this.image.selected},title:function(){return this.selected?"Undo marking as interesting":"Mark as interesting"}},methods:{getBlob:function(){return biigle.$require("maia.api.maiaAnnotation").getFile({id:this.image.id})}}});